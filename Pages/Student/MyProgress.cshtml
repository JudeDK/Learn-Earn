@page
@model Learn_Earn.Pages.Student.MyProgressModel
@{
    ViewData["Title"] = "My progress";
}

<h1>My progress</h1>

<div class="mb-4">
    <h4>Completed lessons (@Model.CompletedLessons.Count)</h4>
    @if (!Model.CompletedLessons.Any())
    {
        <p>You have not completed any lesson yet.</p>
    }
    else
    {
        <ul class="list-group">
            @foreach (var item in Model.CompletedLessons)
            {
                <li class="list-group-item d-flex justify-content-between align-items-start">
                    <div>
                        <strong>@item.Lesson.Title</strong>
                        <div class="small text-muted">Updated: @item.Progress.UpdatedAt.ToLocalTime().ToString("g")</div>
                    </div>
                    <div>
                        <a class="btn btn-sm btn-outline-primary" asp-page="/Lectii/Details" asp-route-id="@item.Lesson.Id">View lesson</a>
                    </div>
                </li>
            }
        </ul>
    }
</div>

<div>
    <h4>Badges (@Model.Badges.Count)</h4>
    @if (!Model.Badges.Any())
    {
        <p>You have not earned any badges yet.</p>
    }
    else
    {
        <div class="mb-3">
            @foreach (var b in Model.Badges)
            {
                <span class="badge bg-secondary me-1">@b.Name</span>
            }
        </div>
    }

    <h4>Quizzes / attempts (@Model.QuizAttempts.Count)</h4>
    @if (!Model.QuizAttempts.Any())
    {
        <p>You have not taken any quizzes yet.</p>
    }
    else
    {
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Quiz</th>
                    <th>Score</th>
                    <th>Date</th>
                    <th>Validated</th>
                    <th>Teacher note</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var a in Model.QuizAttempts)
                {
                    var title = Model.QuizTitles.ContainsKey(a.QuizId) ? Model.QuizTitles[a.QuizId] : ("Quiz " + a.QuizId);
                    var lessonId = Model.QuizLessonIds.ContainsKey(a.QuizId) ? Model.QuizLessonIds[a.QuizId] : (int?)null;
                    <tr>
                        <td>
                            @if (lessonId.HasValue)
                            {
                                <a asp-page="/Lectii/Details" asp-route-id="@lessonId">@title</a>
                            }
                            else
                            {
                                @title
                            }
                        </td>
                        <td>@a.Score / @a.Total</td>
                        <td>@a.AttemptedAt.ToLocalTime().ToString("g")</td>
                        <td>@(a.IsValidated ? "Yes" : "No")</td>
                        <td>@(string.IsNullOrEmpty(a.ValidationNote) ? "-" : a.ValidationNote)</td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>
